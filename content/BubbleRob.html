<!doctype html>
<html><head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>CMSimfly</title> <link rel="stylesheet" type="text/css" href="./../static/cmsimply.css">
<script src="tipuesearch_content.js"></script>
<script src="./../static/jquery.js"></script>
<link rel="stylesheet" href="./../static/tipuesearch/css/tipuesearch.css">
<script src="./../static/tipuesearch/tipuesearch_set.js"></script>
<script src="./../static/tipuesearch/tipuesearch.min.js"></script>

<script type="text/javascript" src="./../static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCSharp.js"></script>
<link type="text/css" rel="stylesheet" href="./../static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>

<!-- for LaTeX equations 暫時不用
<script src="https://scrum-3.github.io/web/math/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'left', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>
-->
<!-- 暫時不用
<script src="./../static/fengari-web.js"></script>
<script type="text/javascript" src="./../static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->
<style>
img {
    border: 2px solid blue;
}
</style>

<script type="text/javascript">
/*shorthand of $(document).ready(function(){};); */
$(function(){
    $("ul.topmenu> li:has(ul) > a").append('<div class="arrow-right"></div>');
    $("ul.topmenu > li ul li:has(ul) > a").append('<div class="arrow-right"></div>');
});
function doSearch() {
     $('#tipue_search_input').tipuesearch({
        newWindow: true, minimumLength: 2
     });
}
$(document).ready(doSearch);
</script>

</head><header><h1>BG4 2019 Spring Product Collaboration Design</h1> <confmenu>
<ul>
<li><a href="index.html">Home</a></li>
<li><a href="sitemap.html">Site Map</a></li>
<li><a href="./../reveal/index.html">reveal</a></li>
<li><a href="./../blog/index.html">blog</a></li>

</ul>
</confmenu></header>
<div class='container'><nav><ul id='css3menu1' class='topmenu'><div class="tipue_search_group"><input style="width: 6vw;" type="text" name="q" id="tipue_search_input" pattern=".{2,}" title="Press enter key to search" required></div><li><a href='Introduction.html'>Introduction</a><li><a href='Group Member.html'>Group Member</a><ul><li><a href='Assignments.html'>Assignments</a></li></ul><li><a href='Internship.html'>Internship</a><ul><li><a href='Internship 1.html'>Internship 1</a><ul><li><a href='隨身系統.html'>隨身系統</a><li><a href='第一週分組程式.html'>第一週分組程式</a></li></ul><li><a href='Internship 2.html'>Internship 2</a><ul><li><a href='V-rep Introduction.html'>V-rep Introduction</a><li><a href='BubbleRob.html'>BubbleRob</a><li><a href='BubbleRob1.html'>BubbleRob1</a></li></ul><li><a href='Internship 3.html'>Internship 3</a><li><a href='Internship 4.html'>Internship 4</a><li><a href='Internship 5.html'>Internship 5</a><li><a href='Internship 6.html'>Internship 6</a></li></ul><li><a href='Weekly Progress.html'>Weekly Progress</a><ul><li><a href='Week4.html'>Week4</a><ul><li><a href='40623210-w4.html'>40623210-w4</a><li><a href='40623224-w4.html'>40623224-w4</a><li><a href='40623225-w4.html'>40623225-w4</a><li><a href='40623226-w4.html'>40623226-w4</a><li><a href='40623227-w4.html'>40623227-w4</a><li><a href='40623234-w4.html'>40623234-w4</a><li><a href='40623238-w4.html'>40623238-w4</a><li><a href='40623239-w4.html'>40623239-w4</a><li><a href='40423158-w4.html'>40423158-w4</a><li><a href='40423232-w4.html'>40423232-w4</a><li><a href='40423237-w4.html'>40423237-w4</a></li></ul><li><a href='Week5.html'>Week5</a><ul><li><a href='40623210-w5.html'>40623210-w5</a><li><a href='40623224-w5.html'>40623224-w5</a><li><a href='40623225-w5.html'>40623225-w5</a><li><a href='40623226-w5.html'>40623226-w5</a><li><a href='40623227-w5.html'>40623227-w5</a><li><a href='40623234-w5.html'>40623234-w5</a><li><a href='40623238-w5.html'>40623238-w5</a><li><a href='40623239-w5.html'>40623239-w5</a><li><a href='40423158-w5.html'>40423158-w5</a><li><a href='40423232-w5.html'>40423232-w5</a><li><a href='40423237-w5.html'>40423237-w5</a></li></ul><li><a href='Week6.html'>Week6</a><ul><li><a href='40623210-w6.html'>40623210-w6</a><li><a href='40623224-w6.html'>40623224-w6</a><li><a href='40623225-w6.html'>40623225-w6</a><li><a href='40623226-w6.html'>40623226-w6</a><li><a href='40623227-w6.html'>40623227-w6</a><li><a href='40623234-w6.html'>40623234-w6</a><li><a href='40623238-w6.html'>40623238-w6</a><li><a href='40623239-w6.html'>40623239-w6</a><li><a href='40423158-w6.html'>40423158-w6</a><li><a href='40423232-w6.html'>40423232-w6</a><li><a href='40423237-w6.html'>40423237-w6</a></li></ul><li><a href='Week7.html'>Week7</a><ul><li><a href='40623210-w7.html'>40623210-w7</a><li><a href='40623224-w7.html'>40623224-w7</a><li><a href='40623225-w7.html'>40623225-w7</a><li><a href='40623226-w7.html'>40623226-w7</a><li><a href='40623227-w7.html'>40623227-w7</a><li><a href='40623234-w7.html'>40623234-w7</a><li><a href='40623238-w7.html'>40623238-w7</a><li><a href='40623239-w7.html'>40623239-w7</a><li><a href='40423158-w7.html'>40423158-w7</a><li><a href='40423232-w7.html'>40423232-w7</a><li><a href='40423237-w7.html'>40423237-w7</a></li></ul><li><a href='Week8.html'>Week8</a><ul><li><a href='40623210-w8.html'>40623210-w8</a><li><a href='40623224-w8.html'>40623224-w8</a><li><a href='40623225-w8.html'>40623225-w8</a><li><a href='40623226-w8.html'>40623226-w8</a><li><a href='40623227-w8.html'>40623227-w8</a><li><a href='40623234-w8.html'>40623234-w8</a><li><a href='40623238-w8.html'>40623238-w8</a><li><a href='40623239-w8.html'>40623239-w8</a><li><a href='40423158-w8.html'>40423158-w8</a><li><a href='40423232-w8.html'>40423232-w8</a><li><a href='40423237-w8.html'>40423237-w8</a></li></ul><li><a href='Week10.html'>Week10</a><ul><li><a href='40623210-w10.html'>40623210-w10</a><li><a href='40623224-w10.html'>40623224-w10</a><li><a href='40623225-w10.html'>40623225-w10</a><li><a href='40623226-w10.html'>40623226-w10</a><li><a href='40623227-w10.html'>40623227-w10</a><li><a href='40623234-w10.html'>40623234-w10</a><li><a href='40623238-w10.html'>40623238-w10</a><li><a href='40623239-w10.html'>40623239-w10</a><li><a href='40423158-w10.html'>40423158-w10</a><li><a href='40423232-w10.html'>40423232-w10</a><li><a href='40423237-w10.html'>40423237-w10</a></li></ul><li><a href='Week11.html'>Week11</a><ul><li><a href='40623210-w11.html'>40623210-w11</a><li><a href='40623224-w11.html'>40623224-w11</a><li><a href='40623225-w11.html'>40623225-w11</a><li><a href='40623226-w11.html'>40623226-w11</a><li><a href='40623227-w11.html'>40623227-w11</a><li><a href='40623234-w11.html'>40623234-w11</a><li><a href='40623238-w11.html'>40623238-w11</a><li><a href='40623239-w11.html'>40623239-w11</a><li><a href='40423158-w11.html'>40423158-w11</a><li><a href='40423232-w11.html'>40423232-w11</a><li><a href='40423237-w11.html'>40423237-w11</a></li></ul><li><a href='Week12.html'>Week12</a><ul><li><a href='40623210-w12.html'>40623210-w12</a><li><a href='40623224-w12.html'>40623224-w12</a><li><a href='40623225-w12.html'>40623225-w12</a><li><a href='40623226-w12.html'>40623226-w12</a><li><a href='40623227-w12.html'>40623227-w12</a><li><a href='40623234-w12.html'>40623234-w12</a><li><a href='40623238-w12.html'>40623238-w12</a><li><a href='40623239-w12.html'>40623239-w12</a><li><a href='40423158-w12.html'>40423158-w12</a><li><a href='40423232-w12.html'>40423232-w12</a><li><a href='40423237-w12.html'>40423237-w12</a></li></ul><li><a href='Week13.html'>Week13</a><ul><li><a href='40623210-w13.html'>40623210-w13</a><li><a href='40623224-w13.html'>40623224-w13</a><li><a href='40623225-w13.html'>40623225-w13</a><li><a href='40623226-w13.html'>40623226-w13</a><li><a href='40623227-w13.html'>40623227-w13</a><li><a href='40623234-w13.html'>40623234-w13</a><li><a href='40623238-w13.html'>40623238-w13</a><li><a href='40623239-w13.html'>40623239-w13</a><li><a href='40423158-w13.html'>40423158-w13</a><li><a href='40423232-w13.html'>40423232-w13</a><li><a href='40423237-w13.html'>40423237-w13</a></li></ul><li><a href='Week14.html'>Week14</a><ul><li><a href='40623210-w14.html'>40623210-w14</a><li><a href='40623224-w14.html'>40623224-w14</a><li><a href='40623225-w14.html'>40623225-w14</a><li><a href='40623226-w14.html'>40623226-w14</a><li><a href='40623227-w14.html'>40623227-w14</a><li><a href='40623234-w14.html'>40623234-w14</a><li><a href='40623238-w14.html'>40623238-w14</a><li><a href='40623239-w14.html'>40623239-w14</a><li><a href='40423158-w14.html'>40423158-w14</a><li><a href='40423232-w14.html'>40423232-w14</a><li><a href='40423237-w14.html'>40423237-w14</a></li></ul><li><a href='Week15.html'>Week15</a><ul><li><a href='40623210-w15.html'>40623210-w15</a><li><a href='40623224-w15.html'>40623224-w15</a><li><a href='40623225-w15.html'>40623225-w15</a><li><a href='40623226-w15.html'>40623226-w15</a><li><a href='40623227-w15.html'>40623227-w15</a><li><a href='40623234-w15.html'>40623234-w15</a><li><a href='40623238-w15.html'>40623238-w15</a><li><a href='40623239-w15.html'>40623239-w15</a><li><a href='40423158-w15.html'>40423158-w15</a><li><a href='40423232-w15.html'>40423232-w15</a><li><a href='40423237-w15.html'>40423237-w15</a></li></ul><li><a href='Week16.html'>Week16</a><ul><li><a href='40623210-w16.html'>40623210-w16</a><li><a href='40623224-w16.html'>40623224-w16</a><li><a href='40623225-w16.html'>40623225-w16</a><li><a href='40623226-w16.html'>40623226-w16</a><li><a href='40623227-w16.html'>40623227-w16</a><li><a href='40623234-w16.html'>40623234-w16</a><li><a href='40623238-w16.html'>40623238-w16</a><li><a href='40623239-w16.html'>40623239-w16</a><li><a href='40423158-w16.html'>40423158-w16</a><li><a href='40423232-w16.html'>40423232-w16</a><li><a href='40423237-w16.html'>40423237-w16</a></li></ul><li><a href='Week17.html'>Week17</a><ul><li><a href='40623210-w17.html'>40623210-w17</a><li><a href='40623224-w17.html'>40623224-w17</a><li><a href='40623225-w17.html'>40623225-w17</a><li><a href='40623226-w17.html'>40623226-w17</a><li><a href='40623227-w17.html'>40623227-w17</a><li><a href='40623234-w17.html'>40623234-w17</a><li><a href='40623238-w17.html'>40623238-w17</a><li><a href='40623239-w17.html'>40623239-w17</a><li><a href='40423158-w17.html'>40423158-w17</a><li><a href='40423232-w17.html'>40423232-w17</a><li><a href='40423237-w17.html'>40423237-w17</a></li></li></ul></ul><li><a href='Operation Demo.html'>Operation Demo</a><ul><li><a href='Teaching film.html'>Teaching film</a><li><a href='如何建立可攜程式系統.html'>如何建立可攜程式系統</a><li><a href='Start.bat製作.html'>Start.bat製作</a><li><a href='Stop.bat製作.html'>Stop.bat製作</a><li><a href='Kungit 製作.html'>Kungit 製作</a><ul><li><a href='Kungit使用教學.html'>Kungit使用教學</a></li></li></ul></ul><li><a href='Onshape.html'>Onshape</a><ul><li><a href='Sketch.html'>Sketch</a><li><a href='Finish Drawing.html'>Finish Drawing</a></li></ul><li><a href='V-rep Simulation.html'>V-rep Simulation</a><ul><li><a href='Tutorial.html'>Tutorial</a><li><a href='手足球模擬.html'>手足球模擬</a></li></ul><li><a href='Organize Git Book.html'>Organize Git Book</a><ul><li><a href='Chapter 1.html'>Chapter 1</a><li><a href='Chapter 2.html'>Chapter 2</a><li><a href='Chapter 3.html'>Chapter 3</a><li><a href='Chapter 4.html'>Chapter 4</a><li><a href='Chapter 5.html'>Chapter 5</a><li><a href='Chapter 6.html'>Chapter 6</a><li><a href='Chapter 7.html'>Chapter 7</a><li><a href='Chapter 8.html'>Chapter 8</a><li><a href='Chapter 9.html'>Chapter 9</a><li><a href='Chapter 10.html'>Chapter 10</a></li></ul><li><a href='Experience.html'>Experience</a><ul><li><a href='40623210.html'>40623210</a><li><a href='40623224.html'>40623224</a><li><a href='40623225.html'>40623225</a><li><a href='40623226.html'>40623226</a><li><a href='40623227.html'>40623227</a><li><a href='40623234.html'>40623234</a><li><a href='40623238.html'>40623238</a><li><a href='40623239.html'>40623239</a><li><a href='40423158.html'>40423158</a><li><a href='40423232.html'>40423232</a><li><a href='40423237.html'>40423237</a></li></ul><li><a href='Required Skills.html'>Required Skills</a><ul><li><a href='Git http & ssh.html'>Git http & ssh</a><li><a href='Directory Structure.html'>Directory Structure</a><li><a href='Page Editing.html'>Page Editing</a><ul><li><a href='插入程式碼.html'>插入程式碼</a></li></ul><li><a href='Internet Reveal.html'>Internet Reveal</a><li><a href='Blog Editor.html'>Blog Editor</a></li></ul><li><a href='Issue & Solution.html'>Issue & Solution</a><li><a href='期中報告.html'>期中報告</a><ul><li><a href='40623210-w9.html'>40623210-w9</a><li><a href='40623224-w9.html'>40623224-w9</a><li><a href='40623225-w9.html'>40623225-w9</a><li><a href='40623226-w9.html'>40623226-w9</a><li><a href='40623227-w9.html'>40623227-w9</a><li><a href='40623234-w9.html'>40623234-w9</a><li><a href='40623238-w9.html'>40623238-w9</a><li><a href='40623239-w9.html'>40623239-w9</a><li><a href='40423158-w9.html'>40423158-w9</a><li><a href='40423232-W9.html'>40423232-W9</a><li><a href='40423237-w9.html'>40423237-w9</a></li></ul></nav><section><div id="tipue_search_content">V-rep Introduction << <a href='V-rep Introduction.html'>Previous</a> <a href='BubbleRob1.html'>Next</a> >> BubbleRob1<br /><h1>BubbleRob</h1>
<h4>V-rep user manual:</h4>
<p><a href="http://www.coppeliarobotics.com/helpFiles/">http://www.coppeliarobotics.com/helpFiles/</a></p>
<h4>BubbleRob Tutorial:</h4>
<p><a href="http://www.coppeliarobotics.com/helpFiles/en/bubbleRobTutorial.htm">http://www.coppeliarobotics.com/helpFiles/en/bubbleRobTutorial.htm</a> </p>
<p>操作步驟參考: <a href="http://fid.cl/courses/ai-robotics/vrep-tut/tutorial_VREP_bob.pdf">http://fid.cl/courses/ai-robotics/vrep-tut/tutorial_VREP_bob.pdf</a>  (<a href="http://mde.tw/cd2019./../downloads/tutorial_VREP_bob.pdf">tutorial_VREP_bob.pdf</a>)</p>
<p><a href="http://mde.tw/cd2019./../downloads/introduction_to_robotics_mechanics_planning_and_control.pdf">introduction_to_robotics_mechanics_planning_and_control.pdf</a></p>
<p><a href="http://mde.tw/cd2019./../downloads/ModernRobotics.zip">modern_robotics.zip</a></p>
<p><a href="http://mde.tw/cd2019./../downloads/ModernRobotics_lib.7z">modern_robotics_lib.zip</a> (<a href="https://github.com/NxRLab/ModernRobotics">https://github.com/NxRLab/ModernRobotics</a><span> </span>)</p>
<p><a href="http://mde.tw/cd2019./../downloads/IKexercise.pdf">Inverse Kinematics.pdf</a></p>
<p><a href="http://mde.tw/cd2019./../downloads/MR_practice_exercises.pdf">modern_robotics_exercise.pdf</a></p>
<p>V-rep Introduction: <a href="http://hades.mech.northwestern.edu/index.php/V-REP_Introduction">http://hades.mech.northwestern.edu/index.php/V-REP_Introduction</a> </p>
<p>Get started with V-rep: <a href="http://hades.mech.northwestern.edu/index.php/Getting_Started_with_the_V-REP_Simulator">http://hades.mech.northwestern.edu/index.php/Getting_Started_with_the_V-REP_Simulator</a> </p>
<h4>動態模擬考量</h4>
<p>If we run the simulation again, we can notice that both objects do not interfere<br/>anymore. However, we notice that BubbleRob slightly moves, even with locked motor.</p>
<p>We also try to run the simulation with different physics engines: the result will be<br/>different. Stability of dynamic simulations is tightly linked to masses and inertias of<br/>the involved non-static shapes.</p>
<p>This has to do with the objects masses: Keep masses similar and not too light.<br/>When linking two shapes with a dynamically enabled joint or a dynamically enabled<br/>force sensor, make sure the two shape’s masses are not too different (m1 &lt; 10 ∗ m2<br/>and m2 &lt; 10 ∗ m1), otherwise the joint or force sensor might be very soft and wobbly<br/>and present large positional/orientational errors (this effect can however also be used<br/>as a natural damping sometimes).</p>
<p>Additionally, very low mass shapes should be avoided since they won’t be able to<br/>exert very large forces onto other shapes (even if propelled by high force actuators!).<br/>Lastly, the intertia has a role to play: Keep principal moments of inertia* relatively<br/>large.</p>
<p>Try keeping the principal moments of inertia / mass (*refer to the shape dynamics<br/>properties dialog) relatively large, otherwise mechanical chains might be difficult to<br/>control and/or might behave in a strange way.</p>
<p>Therefore, we need to multiply all involved object’s masses by 8</p>
<h4>建立 Model</h4>
<p><span>We now need to finish </span><strong>BubbleRob</strong><span><span> </span>as a<span> </span></span><a href="http://www.coppeliarobotics.com/helpFiles/en/models.htm">model</a><span><span> </span>definition. We select the model base (i.e. object<span> </span></span><em>bubbleRob</em><span>) then check items<span> </span></span><strong>Object is model base</strong><span><span> </span>and<span> </span></span><strong>Object/model can transfer or accept DNA</strong><span><span> </span>in the<span> </span></span><a href="http://www.coppeliarobotics.com/helpFiles/en/commonPropertiesDialog.htm">object common properties</a><span>: there is now a stippled bounding box that encompasses all objects in the model hierarchy.</span></p>
<p><span>We select the two joints, the proximity sensor and the graph, then enable item<span> <strong>Ignored by model bounding box</strong></span></span><span><span> </span>and click<span> </span></span><strong>Apply to selection</strong><span>, in the same dialog: the model bounding box now ignores the two joints and the proximity sensor. Still in the same dialog, we disable<span> </span></span><strong>camera visibility layer</strong><span><span> </span>2, and enable<span> </span></span><strong>camera visibility layer</strong><span><span> </span>10 for the two joints and the force sensor: this effectively hides the two joints and the force sensor, since layers 9-16 are disabled by default.</span></p>
<p><span>At any time we can<span> </span></span><a href="http://www.coppeliarobotics.com/helpFiles/en/layerSelectionDialog.htm">modify the visibility layers for the whole scene</a><span>. To finish the model definition, we select the vision sensor, the two wheels, the slider, and the graph, then enable item<span> </span></span><strong>Select base of model instead</strong><span>: if we now try to select an object in our model in the scene, the whole model will be selected instead, which is a convenient way to handle and manipulate the whole model as a single object.</span></p>
<p><span>Additionally, this protects the model against inadvertant modification. Individual objects in the model can still be selected in the scene by click-selecting them with control-shift, or normally selecting them in the scene hierarchy. We finally collapse the model tree in the scene hierarchy. This is what we have:</span></p>
<h4><span>新增 Vision Sensor</span></h4>
<p><span>Next we will add a vision sensor, at the same position and orientation as BubbleRob's proximity sensor. We open the model hierarchy again, then click [Menu bar --&gt; Add --&gt; Vision sensor --&gt; Perspective type], then attach the vision sensor to the proximity sensor, and set the local position and orientation of the vision sensor to (0,0,0).</span></p>
<p><span>We also make sure the vision sensor is not not visible, not part of the model bounding box, and that if clicked, the model will be selected instead. In order to customize the vision sensor, we open its properties dialog. We set the Far clipping plane item to 1, and the Resolution x and Resolution y items to 256 and 256.</span></p>
<p><span>We then open the vision sensor filter dialog by clicking Show filter dialog. We select the filter component Edge detection on work image and click Add filter. We position the newly added filter in second position (one position up, using the up button). We double-click the newly added filter component and adjust its Threshold item to 0.2, then click OK. We add a floating view to the scene, and over the newly added floating view, right-click [Popup menu --&gt; View --&gt; Associate view with selected vision sensor] (we make sure the vision sensor is selected during that process).</span></p>
<p><span>To be able to see the vision sensor's image, we start the simulation, then stop it again.<br/>The last thing that we need for our scene is a small child script that will control BubbleRob's behavior. We select bubbleRob and click [Menu bar --&gt; Add --&gt; Associated child script --&gt; Non threaded]. This just added a non-threaded child script to the scene, and associated it with bubbleRob.</span></p>
<p><span>We can also add, remove or modify scripts via the script dialog which can be opened with [Menu bar --&gt; Tools --&gt; Scripts] or through the appropriate toolbar button:</span></p>
<h4><span>Lua 控制程式</span></h4>
<p><span>[</span></p>
<div class="line number1 index0 alt2"><code class="lua keyword">function</code> <code class="lua plain">speedChange_callback(ui,id,newVal)</code></div>
<div class="line number2 index1 alt1"><code class="lua spaces">    </code><code class="lua plain">speed=minMaxSpeed[1]+(minMaxSpeed[2]-minMaxSpeed[1])*newVal/100</code></div>
<div class="line number3 index2 alt2"><code class="lua keyword">end</code></div>
<div class="line number4 index3 alt1"> </div>
<div class="line number5 index4 alt2"><code class="lua keyword">function</code> <code class="lua plain">sysCall_init()</code></div>
<div class="line number6 index5 alt1"><code class="lua spaces">    </code><code class="lua comments">-- This is executed exactly once, the first time this script is executed</code></div>
<div class="line number7 index6 alt2"><code class="lua spaces">    </code><code class="lua plain">bubbleRobBase=sim.getObjectAssociatedWithScript(sim.handle_self) </code><code class="lua comments">-- this is bubbleRob's handle</code></div>
<div class="line number8 index7 alt1"><code class="lua spaces">    </code><code class="lua plain">leftMotor=sim.getObjectHandle(</code><code class="lua string">"bubbleRob_leftMotor"</code><code class="lua plain">) </code><code class="lua comments">-- Handle of the left motor</code></div>
<div class="line number9 index8 alt2"><code class="lua spaces">    </code><code class="lua plain">rightMotor=sim.getObjectHandle(</code><code class="lua string">"bubbleRob_rightMotor"</code><code class="lua plain">) </code><code class="lua comments">-- Handle of the right motor</code></div>
<div class="line number10 index9 alt1"><code class="lua spaces">    </code><code class="lua plain">noseSensor=sim.getObjectHandle(</code><code class="lua string">"bubbleRob_sensingNose"</code><code class="lua plain">) </code><code class="lua comments">-- Handle of the proximity sensor</code></div>
<div class="line number11 index10 alt2"><code class="lua spaces">    </code><code class="lua plain">minMaxSpeed={50*</code><code class="lua functions">math.pi</code><code class="lua plain">/180,300*</code><code class="lua functions">math.pi</code><code class="lua plain">/180} </code><code class="lua comments">-- Min and max speeds for each motor</code></div>
<div class="line number12 index11 alt1"><code class="lua spaces">    </code><code class="lua plain">backUntilTime=-1 </code><code class="lua comments">-- Tells whether bubbleRob is in forward or backward mode</code></div>
<div class="line number13 index12 alt2"><code class="lua spaces">    </code><code class="lua comments">-- Create the custom UI:</code></div>
<div class="line number14 index13 alt1"><code class="lua spaces">        </code><code class="lua plain">xml = </code><code class="lua string">'&lt;ui title="'</code><code class="lua plain">..sim.getObjectName(bubbleRobBase)..</code><code class="lua string">' speed" closeable="false" resizeable="false" activate="false"&gt;'</code><code class="lua plain">..[[</code></div>
<div class="line number15 index14 alt2"><code class="lua spaces">        </code><code class="lua plain">&lt;hslider minimum=</code><code class="lua string">"0"</code> <code class="lua plain">maximum=</code><code class="lua string">"100"</code> <code class="lua plain">onchange=</code><code class="lua string">"speedChange_callback"</code> <code class="lua plain">id=</code><code class="lua string">"1"</code><code class="lua plain">/&gt;</code></div>
<div class="line number16 index15 alt1"><code class="lua spaces">        </code><code class="lua plain">&lt;label text=</code><code class="lua string">""</code> <code class="lua plain">style=</code><code class="lua string">"* {margin-left: 300px;}"</code><code class="lua plain">/&gt;</code></div>
<div class="line number17 index16 alt2"><code class="lua spaces">        </code><code class="lua plain">&lt;/ui&gt;</code></div>
<div class="line number18 index17 alt1"><code class="lua spaces">        </code><code class="lua plain">]]</code></div>
<div class="line number19 index18 alt2"><code class="lua spaces">    </code><code class="lua plain">ui=simUI.create(xml)</code></div>
<div class="line number20 index19 alt1"><code class="lua spaces">    </code><code class="lua plain">speed=(minMaxSpeed[1]+minMaxSpeed[2])*0.5</code></div>
<div class="line number21 index20 alt2"><code class="lua spaces">    </code><code class="lua plain">simUI.setSliderValue(ui,1,100*(speed-minMaxSpeed[1])/(minMaxSpeed[2]-minMaxSpeed[1]))</code></div>
<div class="line number22 index21 alt1"><code class="lua keyword">end</code></div>
<div class="line number23 index22 alt2"> </div>
<div class="line number24 index23 alt1"><code class="lua keyword">function</code> <code class="lua plain">sysCall_actuation()</code></div>
<div class="line number25 index24 alt2"><code class="lua spaces">    </code><code class="lua plain">result=sim.readProximitySensor(noseSensor) </code><code class="lua comments">-- Read the proximity sensor</code></div>
<div class="line number26 index25 alt1"><code class="lua spaces">    </code><code class="lua comments">-- If we detected something, we set the backward mode:</code></div>
<div class="line number27 index26 alt2"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua plain">(result&gt;0) </code><code class="lua keyword">then</code> <code class="lua plain">backUntilTime=sim.getSimulationTime()+4 </code><code class="lua keyword">end</code></div>
<div class="line number28 index27 alt1"> </div>
<div class="line number29 index28 alt2"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua plain">(backUntilTime&lt;sim.getSimulationTime()) </code><code class="lua keyword">then</code></div>
<div class="line number30 index29 alt1"><code class="lua spaces">        </code><code class="lua comments">-- When in forward mode, we simply move forward at the desired speed</code></div>
<div class="line number31 index30 alt2"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(leftMotor,speed)</code></div>
<div class="line number32 index31 alt1"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(rightMotor,speed)</code></div>
<div class="line number33 index32 alt2"><code class="lua spaces">    </code><code class="lua keyword">else</code></div>
<div class="line number34 index33 alt1"><code class="lua spaces">        </code><code class="lua comments">-- When in backward mode, we simply backup in a curve at reduced speed</code></div>
<div class="line number35 index34 alt2"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(leftMotor,-speed/2)</code></div>
<div class="line number36 index35 alt1"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(rightMotor,-speed/8)</code></div>
<div class="line number37 index36 alt2"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number38 index37 alt1"><code class="lua keyword">end</code></div>
<div class="line number39 index38 alt2"> </div>
<div class="line number40 index39 alt1"><code class="lua keyword">function</code> <code class="lua plain">sysCall_cleanup()</code></div>
<div class="line number41 index40 alt2"><code class="lua spaces">    </code><code class="lua plain">simUI.destroy(ui)</code></div>
<div class="line number42 index41 alt1"><code class="lua keyword">end</code></div>
<div class="line number42 index41 alt1"><code class="lua keyword"></code></div>
<div class="line number42 index41 alt1"><code class="lua keyword">]</code></div>
<div class="line number42 index41 alt1"><code class="lua keyword"></code></div>
<h4>Building Clean Model</h4>
<p><a href="http://www.coppeliarobotics.com/helpFiles/en/buildingAModelTutorial.htm">http://www.coppeliarobotics.com/helpFiles/en/buildingAModelTutorial.htm</a> </p>
<h4>Designing Dynamic Simulation</h4>
<p><a href="http://www.coppeliarobotics.com/helpFiles/en/designingDynamicSimulations.htm#staticAndRespondable">http://www.coppeliarobotics.com/helpFiles/en/designingDynamicSimulations.htm#staticAndRespondable</a> </p>
<h4>ResizeableFloor</h4>
<p>網際 Lua 程式執行環境: <a href="http://mde.tw/vecp2018/lua/SchoolProject/">http://mde.tw/vecp2018/lua/SchoolProject/</a> </p>
<p></p>
<p>[</p>
<div class="line number1 index0 alt2"><code class="lua keyword">function</code> <code class="lua plain">sysCall_init()</code></div>
<div class="line number2 index1 alt1"><code class="lua spaces">    </code><code class="lua plain">model=sim.getObjectAssociatedWithScript(sim.handle_self)</code></div>
<div class="line number3 index2 alt2"><code class="lua spaces">    </code><code class="lua plain">e1=sim.getObjectHandle(</code><code class="lua string">'ResizableFloor_5_25_element'</code><code class="lua plain">)</code></div>
<div class="line number4 index3 alt1"><code class="lua spaces">    </code><code class="lua plain">e2=sim.getObjectHandle(</code><code class="lua string">'ResizableFloor_5_25_visibleElement'</code><code class="lua plain">)</code></div>
<div class="line number5 index4 alt2"><code class="lua keyword">end</code></div>
<div class="line number6 index5 alt1"> </div>
<div class="line number7 index6 alt2"><code class="lua keyword">function</code> <code class="lua plain">sysCall_cleanup()</code></div>
<div class="line number8 index7 alt1"><code class="lua spaces">    </code><code class="lua plain">hideDlg()</code></div>
<div class="line number9 index8 alt2"><code class="lua keyword">end</code></div>
<div class="line number10 index9 alt1"> </div>
<div class="line number11 index10 alt2"><code class="lua keyword">function</code> <code class="lua plain">sysCall_nonSimulation()</code></div>
<div class="line number12 index11 alt1"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">s=sim.getObjectSelection()</code></div>
<div class="line number13 index12 alt2"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua plain">s </code><code class="lua keyword">and</code> <code class="lua plain">#s&gt;=1 </code><code class="lua keyword">and</code> <code class="lua plain">s[1]==model </code><code class="lua keyword">then</code></div>
<div class="line number14 index13 alt1"><code class="lua spaces">        </code><code class="lua plain">showDlg()</code></div>
<div class="line number15 index14 alt2"><code class="lua spaces">    </code><code class="lua keyword">else</code></div>
<div class="line number16 index15 alt1"><code class="lua spaces">        </code><code class="lua plain">hideDlg()</code></div>
<div class="line number17 index16 alt2"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number18 index17 alt1"><code class="lua keyword">end</code></div>
<div class="line number19 index18 alt2"> </div>
<div class="line number20 index19 alt1"><code class="lua keyword">function</code> <code class="lua plain">sysCall_beforeSimulation()</code></div>
<div class="line number21 index20 alt2"><code class="lua spaces">    </code><code class="lua plain">hideDlg()</code></div>
<div class="line number22 index21 alt1"><code class="lua keyword">end</code></div>
<div class="line number23 index22 alt2"> </div>
<div class="line number24 index23 alt1"><code class="lua keyword">function</code> <code class="lua plain">sysCall_beforeSimulation()</code></div>
<div class="line number25 index24 alt2"><code class="lua spaces">    </code><code class="lua plain">hideDlg()</code></div>
<div class="line number26 index25 alt1"><code class="lua keyword">end</code></div>
<div class="line number27 index26 alt2"> </div>
<div class="line number28 index27 alt1"><code class="lua keyword">function</code> <code class="lua plain">updateFloor()</code></div>
<div class="line number29 index28 alt2"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">c=readInfo()</code></div>
<div class="line number30 index29 alt1"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">sx=c[</code><code class="lua string">'sizes'</code><code class="lua plain">][1]/5</code></div>
<div class="line number31 index30 alt2"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">sy=c[</code><code class="lua string">'sizes'</code><code class="lua plain">][2]/5</code></div>
<div class="line number32 index31 alt1"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">sizeFact=sim.getObjectSizeFactor(model)</code></div>
<div class="line number33 index32 alt2"><code class="lua spaces">    </code><code class="lua plain">sim.setObjectParent(e1,-1,</code><code class="lua keyword">true</code><code class="lua plain">)</code></div>
<div class="line number34 index33 alt1"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">child=sim.getObjectChild(model,0)</code></div>
<div class="line number35 index34 alt2"><code class="lua spaces">    </code><code class="lua keyword">while</code> <code class="lua plain">child~=-1 </code><code class="lua keyword">do</code></div>
<div class="line number36 index35 alt1"><code class="lua spaces">        </code><code class="lua plain">sim.removeObject(child)</code></div>
<div class="line number37 index36 alt2"><code class="lua spaces">        </code><code class="lua plain">child=sim.getObjectChild(model,0)</code></div>
<div class="line number38 index37 alt1"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number39 index38 alt2"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">xPosInit=(sx-1)*-2.5*sizeFact</code></div>
<div class="line number40 index39 alt1"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">yPosInit=(sy-1)*-2.5*sizeFact</code></div>
<div class="line number41 index40 alt2"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">f1,f2</code></div>
<div class="line number42 index41 alt1"><code class="lua spaces">    </code><code class="lua keyword">for</code> <code class="lua plain">x=1,sx,1 </code><code class="lua keyword">do</code></div>
<div class="line number43 index42 alt2"><code class="lua spaces">        </code><code class="lua keyword">for</code> <code class="lua plain">y=1,sy,1 </code><code class="lua keyword">do</code></div>
<div class="line number44 index43 alt1"><code class="lua spaces">            </code><code class="lua keyword">if</code> <code class="lua plain">(x==1)</code><code class="lua keyword">and</code><code class="lua plain">(y==1) </code><code class="lua keyword">then</code></div>
<div class="line number45 index44 alt2"><code class="lua spaces">                </code><code class="lua plain">sim.setObjectParent(e1,model,</code><code class="lua keyword">true</code><code class="lua plain">)</code></div>
<div class="line number46 index45 alt1"><code class="lua spaces">                </code><code class="lua plain">f1=e1</code></div>
<div class="line number47 index46 alt2"><code class="lua spaces">            </code><code class="lua keyword">else</code></div>
<div class="line number48 index47 alt1"><code class="lua spaces">                </code><code class="lua plain">f1=sim.copyPasteObjects({e1},0)[1]</code></div>
<div class="line number49 index48 alt2"><code class="lua spaces">                </code><code class="lua plain">f2=sim.copyPasteObjects({e2},0)[1]</code></div>
<div class="line number50 index49 alt1"><code class="lua spaces">                </code><code class="lua plain">sim.setObjectParent(f1,model,</code><code class="lua keyword">true</code><code class="lua plain">)</code></div>
<div class="line number51 index50 alt2"><code class="lua spaces">                </code><code class="lua plain">sim.setObjectParent(f2,f1,</code><code class="lua keyword">true</code><code class="lua plain">)</code></div>
<div class="line number52 index51 alt1"><code class="lua spaces">            </code><code class="lua keyword">end</code></div>
<div class="line number53 index52 alt2"><code class="lua spaces">            </code><code class="lua keyword">local</code> <code class="lua plain">p=sim.getObjectPosition(f1,sim.handle_parent)</code></div>
<div class="line number54 index53 alt1"><code class="lua spaces">            </code><code class="lua plain">p[1]=xPosInit+(x-1)*5*sizeFact</code></div>
<div class="line number55 index54 alt2"><code class="lua spaces">            </code><code class="lua plain">p[2]=yPosInit+(y-1)*5*sizeFact</code></div>
<div class="line number56 index55 alt1"><code class="lua spaces">            </code><code class="lua plain">sim.setObjectPosition(f1,sim.handle_parent,p)</code></div>
<div class="line number57 index56 alt2"><code class="lua spaces">        </code><code class="lua keyword">end</code></div>
<div class="line number58 index57 alt1"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number59 index58 alt2"><code class="lua keyword">end</code></div>
<div class="line number60 index59 alt1"> </div>
<div class="line number61 index60 alt2"><code class="lua keyword">function</code> <code class="lua plain">getDefaultInfoForNonExistingFields(info)</code></div>
<div class="line number62 index61 alt1"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua keyword">not</code> <code class="lua plain">info[</code><code class="lua string">'version'</code><code class="lua plain">] </code><code class="lua keyword">then</code></div>
<div class="line number63 index62 alt2"><code class="lua spaces">        </code><code class="lua plain">info[</code><code class="lua string">'version'</code><code class="lua plain">]=0</code></div>
<div class="line number64 index63 alt1"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number65 index64 alt2"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua keyword">not</code> <code class="lua plain">info[</code><code class="lua string">'sizes'</code><code class="lua plain">] </code><code class="lua keyword">then</code></div>
<div class="line number66 index65 alt1"><code class="lua spaces">        </code><code class="lua plain">info[</code><code class="lua string">'sizes'</code><code class="lua plain">]={1,1}</code></div>
<div class="line number67 index66 alt2"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number68 index67 alt1"><code class="lua keyword">end</code></div>
<div class="line number69 index68 alt2"> </div>
<div class="line number70 index69 alt1"><code class="lua keyword">function</code> <code class="lua plain">readInfo()</code></div>
<div class="line number71 index70 alt2"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">data=sim.readCustomDataBlock(model,</code><code class="lua string">'XYZ_FLOOR_INFO'</code><code class="lua plain">)</code></div>
<div class="line number72 index71 alt1"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua plain">data </code><code class="lua keyword">then</code></div>
<div class="line number73 index72 alt2"><code class="lua spaces">        </code><code class="lua plain">data=sim.unpackTable(data)</code></div>
<div class="line number74 index73 alt1"><code class="lua spaces">    </code><code class="lua keyword">else</code></div>
<div class="line number75 index74 alt2"><code class="lua spaces">        </code><code class="lua plain">data={}</code></div>
<div class="line number76 index75 alt1"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number77 index76 alt2"><code class="lua spaces">    </code><code class="lua plain">getDefaultInfoForNonExistingFields(data)</code></div>
<div class="line number78 index77 alt1"><code class="lua spaces">    </code><code class="lua keyword">return</code> <code class="lua plain">data</code></div>
<div class="line number79 index78 alt2"><code class="lua keyword">end</code></div>
<div class="line number80 index79 alt1"> </div>
<div class="line number81 index80 alt2"><code class="lua keyword">function</code> <code class="lua plain">writeInfo(data)</code></div>
<div class="line number82 index81 alt1"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua plain">data </code><code class="lua keyword">then</code></div>
<div class="line number83 index82 alt2"><code class="lua spaces">        </code><code class="lua plain">sim.writeCustomDataBlock(model,</code><code class="lua string">'XYZ_FLOOR_INFO'</code><code class="lua plain">,sim.packTable(data))</code></div>
<div class="line number84 index83 alt1"><code class="lua spaces">    </code><code class="lua keyword">else</code></div>
<div class="line number85 index84 alt2"><code class="lua spaces">        </code><code class="lua plain">sim.writeCustomDataBlock(model,</code><code class="lua string">'XYZ_FLOOR_INFO'</code><code class="lua plain">,</code><code class="lua string">''</code><code class="lua plain">)</code></div>
<div class="line number86 index85 alt1"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number87 index86 alt2"><code class="lua keyword">end</code></div>
<div class="line number88 index87 alt1"> </div>
<div class="line number89 index88 alt2"><code class="lua keyword">function</code> <code class="lua plain">updateUi()</code></div>
<div class="line number90 index89 alt1"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">c=readInfo()</code></div>
<div class="line number91 index90 alt2"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">sizeFact=sim.getObjectSizeFactor(model)</code></div>
<div class="line number92 index91 alt1"><code class="lua spaces">    </code><code class="lua plain">simUI.setLabelText(ui,1,</code><code class="lua string">'X-size (m): '</code><code class="lua plain">..</code><code class="lua functions">string.format</code><code class="lua plain">(</code><code class="lua string">"%.2f"</code><code class="lua plain">,c[</code><code class="lua string">'sizes'</code><code class="lua plain">][1]*sizeFact),</code><code class="lua keyword">true</code><code class="lua plain">)</code></div>
<div class="line number93 index92 alt2"><code class="lua spaces">    </code><code class="lua plain">simUI.setSliderValue(ui,2,c[</code><code class="lua string">'sizes'</code><code class="lua plain">][1]/5,</code><code class="lua keyword">true</code><code class="lua plain">)</code></div>
<div class="line number94 index93 alt1"><code class="lua spaces">    </code><code class="lua plain">simUI.setLabelText(ui,3,</code><code class="lua string">'Y-size (m): '</code><code class="lua plain">..</code><code class="lua functions">string.format</code><code class="lua plain">(</code><code class="lua string">"%.2f"</code><code class="lua plain">,c[</code><code class="lua string">'sizes'</code><code class="lua plain">][2]*sizeFact),</code><code class="lua keyword">true</code><code class="lua plain">)</code></div>
<div class="line number95 index94 alt2"><code class="lua spaces">    </code><code class="lua plain">simUI.setSliderValue(ui,4,c[</code><code class="lua string">'sizes'</code><code class="lua plain">][2]/5,</code><code class="lua keyword">true</code><code class="lua plain">)</code></div>
<div class="line number96 index95 alt1"><code class="lua keyword">end</code></div>
<div class="line number97 index96 alt2"> </div>
<div class="line number98 index97 alt1"><code class="lua keyword">function</code> <code class="lua plain">sliderXChange(ui,id,newVal)</code></div>
<div class="line number99 index98 alt2"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">c=readInfo()</code></div>
<div class="line number100 index99 alt1"><code class="lua spaces">    </code><code class="lua plain">c[</code><code class="lua string">'sizes'</code><code class="lua plain">][1]=newVal*5</code></div>
<div class="line number101 index100 alt2"><code class="lua spaces">    </code><code class="lua plain">writeInfo(c)</code></div>
<div class="line number102 index101 alt1"><code class="lua spaces">    </code><code class="lua plain">updateUi()</code></div>
<div class="line number103 index102 alt2"><code class="lua spaces">    </code><code class="lua plain">updateFloor()</code></div>
<div class="line number104 index103 alt1"><code class="lua keyword">end</code></div>
<div class="line number105 index104 alt2"> </div>
<div class="line number106 index105 alt1"><code class="lua keyword">function</code> <code class="lua plain">sliderYChange(ui,id,newVal)</code></div>
<div class="line number107 index106 alt2"><code class="lua spaces">    </code><code class="lua keyword">local</code> <code class="lua plain">c=readInfo()</code></div>
<div class="line number108 index107 alt1"><code class="lua spaces">    </code><code class="lua plain">c[</code><code class="lua string">'sizes'</code><code class="lua plain">][2]=newVal*5</code></div>
<div class="line number109 index108 alt2"><code class="lua spaces">    </code><code class="lua plain">writeInfo(c)</code></div>
<div class="line number110 index109 alt1"><code class="lua spaces">    </code><code class="lua plain">updateUi()</code></div>
<div class="line number111 index110 alt2"><code class="lua spaces">    </code><code class="lua plain">updateFloor()</code></div>
<div class="line number112 index111 alt1"><code class="lua keyword">end</code></div>
<div class="line number113 index112 alt2"> </div>
<div class="line number114 index113 alt1"><code class="lua keyword">function</code> <code class="lua plain">closeEventHandler(h)</code></div>
<div class="line number115 index114 alt2"><code class="lua spaces">    </code><code class="lua plain">sim.removeScript(sim.handle_self)</code></div>
<div class="line number116 index115 alt1"><code class="lua keyword">end</code></div>
<div class="line number117 index116 alt2"> </div>
<div class="line number118 index117 alt1"><code class="lua keyword">function</code> <code class="lua plain">showDlg()</code></div>
<div class="line number119 index118 alt2"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua keyword">not</code> <code class="lua plain">ui </code><code class="lua keyword">then</code></div>
<div class="line number120 index119 alt1"><code class="lua spaces">    </code><code class="lua plain">xml = [[</code></div>
<div class="line number121 index120 alt2"><code class="lua plain">&lt;ui title=</code><code class="lua string">"Floor Customizer"</code> <code class="lua plain">closeable=</code><code class="lua string">"true"</code> <code class="lua plain">on-close=</code><code class="lua string">"closeEventHandler"</code> <code class="lua plain">resizable=</code><code class="lua string">"false"</code> <code class="lua plain">activate=</code><code class="lua string">"false"</code><code class="lua plain">&gt;</code></div>
<div class="line number122 index121 alt1"><code class="lua spaces">    </code><code class="lua plain">&lt;group layout=</code><code class="lua string">"form"</code> <code class="lua plain">flat=</code><code class="lua string">"true"</code><code class="lua plain">&gt;</code></div>
<div class="line number123 index122 alt2"><code class="lua spaces">        </code><code class="lua plain">&lt;label text=</code><code class="lua string">"X-size (m): 1"</code> <code class="lua plain">id=</code><code class="lua string">"1"</code><code class="lua plain">/&gt;</code></div>
<div class="line number124 index123 alt1"><code class="lua spaces">        </code><code class="lua plain">&lt;hslider tick-position=</code><code class="lua string">"above"</code> <code class="lua plain">tick-interval=</code><code class="lua string">"1"</code> <code class="lua plain">minimum=</code><code class="lua string">"1"</code> <code class="lua plain">maximum=</code><code class="lua string">"5"</code> <code class="lua plain">on-change=</code><code class="lua string">"sliderXChange"</code> <code class="lua plain">id=</code><code class="lua string">"2"</code><code class="lua plain">/&gt;</code></div>
<div class="line number125 index124 alt2"><code class="lua spaces">        </code><code class="lua plain">&lt;label text=</code><code class="lua string">"Y-size (m): 1"</code> <code class="lua plain">id=</code><code class="lua string">"3"</code><code class="lua plain">/&gt;</code></div>
<div class="line number126 index125 alt1"><code class="lua spaces">        </code><code class="lua plain">&lt;hslider tick-position=</code><code class="lua string">"above"</code> <code class="lua plain">tick-interval=</code><code class="lua string">"1"</code> <code class="lua plain">minimum=</code><code class="lua string">"1"</code> <code class="lua plain">maximum=</code><code class="lua string">"5"</code> <code class="lua plain">on-change=</code><code class="lua string">"sliderYChange"</code> <code class="lua plain">id=</code><code class="lua string">"4"</code><code class="lua plain">/&gt;</code></div>
<div class="line number127 index126 alt2"><code class="lua spaces">    </code><code class="lua plain">&lt;/group&gt;</code></div>
<div class="line number128 index127 alt1"><code class="lua spaces">    </code><code class="lua plain">&lt;label text=</code><code class="lua string">""</code> <code class="lua plain">style=</code><code class="lua string">"* {margin-left: 400px;}"</code><code class="lua plain">/&gt;</code></div>
<div class="line number129 index128 alt2"><code class="lua plain">&lt;/ui&gt;</code></div>
<div class="line number130 index129 alt1"><code class="lua plain">]]</code></div>
<div class="line number131 index130 alt2"><code class="lua spaces">        </code><code class="lua plain">ui=simUI.create(xml)</code></div>
<div class="line number132 index131 alt1"><code class="lua spaces">        </code><code class="lua keyword">if</code> <code class="lua plain">2==sim.getInt32Parameter(sim.intparam_platform) </code><code class="lua keyword">then</code></div>
<div class="line number133 index132 alt2"><code class="lua spaces">            </code><code class="lua comments">-- To fix a Qt bug on Linux</code></div>
<div class="line number134 index133 alt1"><code class="lua spaces">            </code><code class="lua plain">sim.auxFunc(</code><code class="lua string">'activateMainWindow'</code><code class="lua plain">)</code></div>
<div class="line number135 index134 alt2"><code class="lua spaces">        </code><code class="lua keyword">end</code></div>
<div class="line number136 index135 alt1"><code class="lua spaces">        </code><code class="lua plain">updateUi()</code></div>
<div class="line number137 index136 alt2"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number138 index137 alt1"><code class="lua keyword">end</code></div>
<div class="line number139 index138 alt2"> </div>
<div class="line number140 index139 alt1"><code class="lua keyword">function</code> <code class="lua plain">hideDlg()</code></div>
<div class="line number141 index140 alt2"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua plain">ui </code><code class="lua keyword">then</code></div>
<div class="line number142 index141 alt1"><code class="lua spaces">        </code><code class="lua plain">simUI.destroy(ui)</code></div>
<div class="line number143 index142 alt2"><code class="lua spaces">        </code><code class="lua plain">ui=</code><code class="lua keyword">nil</code></div>
<div class="line number144 index143 alt1"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number145 index144 alt2"><code class="lua keyword">end</code></div>
<div class="line number145 index144 alt2"><code class="lua keyword"></code></div>
<div class="line number145 index144 alt2"><code class="lua keyword">]</code></div>
<div class="line number145 index144 alt2"><code class="lua keyword"></code></div>
<div class="line number145 index144 alt2"><code class="lua keyword"><span>左右輪分別建立 slider:</span></code></div>
<div class="line number145 index144 alt2"><code class="lua keyword"><span></span></code></div>
<div class="line number145 index144 alt2"><code class="lua keyword"><span>[</span></code></div>
<div class="line number145 index144 alt2"><code class="lua keyword"><span></span></code></div>
<div class="line number145 index144 alt2">
<div class="line number1 index0 alt2"><code class="lua keyword">function</code> <code class="lua plain">sysCall_init()</code></div>
<div class="line number2 index1 alt1"><code class="lua spaces">         </code> </div>
<div class="line number3 index2 alt2"><code class="lua spaces">    </code><code class="lua comments">-- This is executed exactly once, the first time this script is executed</code></div>
<div class="line number4 index3 alt1"><code class="lua spaces">    </code><code class="lua plain">bubbleRobBase=sim.getObjectAssociatedWithScript(sim.handle_self) </code><code class="lua comments">-- this is bubbleRob's handle</code></div>
<div class="line number5 index4 alt2"><code class="lua spaces">    </code><code class="lua plain">leftMotor=sim.getObjectHandle(</code><code class="lua string">"bubbleRob_leftMotor"</code><code class="lua plain">) </code><code class="lua comments">-- Handle of the left motor</code></div>
<div class="line number6 index5 alt1"><code class="lua spaces">    </code><code class="lua plain">rightMotor=sim.getObjectHandle(</code><code class="lua string">"bubbleRob_rightMotor"</code><code class="lua plain">) </code><code class="lua comments">-- Handle of the right motor</code></div>
<div class="line number7 index6 alt2"><code class="lua spaces">    </code><code class="lua plain">noseSensor=sim.getObjectHandle(</code><code class="lua string">"bubbleRob_sensingNose"</code><code class="lua plain">) </code><code class="lua comments">-- Handle of the proximity sensor</code></div>
<div class="line number8 index7 alt1"><code class="lua spaces">    </code><code class="lua plain">minMaxSpeed={50*</code><code class="lua functions">math.pi</code><code class="lua plain">/180,300*</code><code class="lua functions">math.pi</code><code class="lua plain">/180} </code><code class="lua comments">-- Min and max speeds for each motor</code></div>
<div class="line number9 index8 alt2"><code class="lua spaces">    </code><code class="lua plain">backUntilTime=-1 </code><code class="lua comments">-- Tells whether bubbleRob is in forward or backward mode</code></div>
<div class="line number10 index9 alt1"><code class="lua spaces">    </code><code class="lua comments">-- Create the custom UI:</code></div>
<div class="line number11 index10 alt2"><code class="lua spaces">    </code><code class="lua plain">xml = </code><code class="lua string">'&lt;ui title="'</code><code class="lua plain">..sim.getObjectName(bubbleRobBase)..</code><code class="lua string">' speed" closeable="false" resizeable="false" activate="false"&gt;'</code><code class="lua plain">..[[</code></div>
<div class="line number12 index11 alt1"><code class="lua spaces">                </code><code class="lua plain">&lt;label text=</code><code class="lua string">"left motor speed"</code> <code class="lua plain">wordwrap=</code><code class="lua string">"false"</code> <code class="lua plain">/&gt;</code></div>
<div class="line number13 index12 alt2"><code class="lua spaces">                </code><code class="lua plain">&lt;hslider minimum=</code><code class="lua string">"0"</code> <code class="lua plain">maximum=</code><code class="lua string">"100"</code> <code class="lua plain">on-change=</code><code class="lua string">"left_speedChange_callback"</code> <code class="lua plain">id=</code><code class="lua string">"1"</code><code class="lua plain">/&gt;</code></div>
<div class="line number14 index13 alt1"><code class="lua spaces">                </code><code class="lua plain">&lt;label text=</code><code class="lua string">"right motor speed"</code> <code class="lua plain">wordwrap=</code><code class="lua string">"false"</code> <code class="lua plain">/&gt;</code></div>
<div class="line number15 index14 alt2"><code class="lua spaces">                </code><code class="lua plain">&lt;hslider minimum=</code><code class="lua string">"0"</code> <code class="lua plain">maximum=</code><code class="lua string">"100"</code> <code class="lua plain">on-change=</code><code class="lua string">"right_speedChange_callback"</code> <code class="lua plain">id=</code><code class="lua string">"2"</code><code class="lua plain">/&gt;</code></div>
<div class="line number16 index15 alt1"><code class="lua spaces">            </code><code class="lua plain">&lt;label text=</code><code class="lua string">""</code> <code class="lua plain">style=</code><code class="lua string">"* {margin-left: 300px;}"</code><code class="lua plain">/&gt;</code></div>
<div class="line number17 index16 alt2"><code class="lua spaces">        </code><code class="lua plain">&lt;/ui&gt;</code></div>
<div class="line number18 index17 alt1"><code class="lua spaces">        </code><code class="lua plain">]]</code></div>
<div class="line number19 index18 alt2"><code class="lua spaces">    </code><code class="lua plain">ui=simUI.create(xml)</code></div>
<div class="line number20 index19 alt1"><code class="lua spaces">    </code><code class="lua plain">left_speed=(minMaxSpeed[1]+minMaxSpeed[2])*0.5</code></div>
<div class="line number21 index20 alt2"><code class="lua spaces">    </code><code class="lua plain">right_speed=(minMaxSpeed[1]+minMaxSpeed[2])*0.5</code></div>
<div class="line number22 index21 alt1"><code class="lua spaces">    </code><code class="lua plain">simUI.setSliderValue(ui,1,100*(left_speed-minMaxSpeed[1])/(minMaxSpeed[2]-minMaxSpeed[1]))</code></div>
<div class="line number23 index22 alt2"><code class="lua spaces">    </code><code class="lua plain">simUI.setSliderValue(ui,2,100*(left_speed-minMaxSpeed[1])/(minMaxSpeed[2]-minMaxSpeed[1]))</code></div>
<div class="line number24 index23 alt1"><code class="lua spaces">    </code> </div>
<div class="line number25 index24 alt2"><code class="lua keyword">end</code></div>
<div class="line number26 index25 alt1"><code class="lua keyword">function</code> <code class="lua plain">right_speedChange_callback(ui,id,newVal)</code></div>
<div class="line number27 index26 alt2"><code class="lua spaces">    </code><code class="lua plain">right_speed=minMaxSpeed[1]+(minMaxSpeed[2]-minMaxSpeed[1])*newVal/100</code></div>
<div class="line number28 index27 alt1"><code class="lua keyword">end</code></div>
<div class="line number29 index28 alt2"> </div>
<div class="line number30 index29 alt1"><code class="lua keyword">function</code> <code class="lua plain">left_speedChange_callback(ui,id,newVal)</code></div>
<div class="line number31 index30 alt2"><code class="lua spaces">    </code><code class="lua plain">left_speed=minMaxSpeed[1]+(minMaxSpeed[2]-minMaxSpeed[1])*newVal/100</code></div>
<div class="line number32 index31 alt1"><code class="lua keyword">end</code></div>
<div class="line number33 index32 alt2"> </div>
<div class="line number34 index33 alt1"> </div>
<div class="line number35 index34 alt2"><code class="lua keyword">function</code> <code class="lua plain">sysCall_actuation() </code></div>
<div class="line number36 index35 alt1"><code class="lua spaces">    </code><code class="lua plain">result=sim.readProximitySensor(noseSensor) </code><code class="lua comments">-- Read the proximity sensor</code></div>
<div class="line number37 index36 alt2"><code class="lua spaces">    </code><code class="lua comments">-- If we detected something, we set the backward mode:</code></div>
<div class="line number38 index37 alt1"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua plain">(result&gt;0) </code><code class="lua keyword">then</code> <code class="lua plain">backUntilTime=sim.getSimulationTime()+4 </code><code class="lua keyword">end</code></div>
<div class="line number39 index38 alt2"> </div>
<div class="line number40 index39 alt1"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua plain">(backUntilTime&lt;sim.getSimulationTime()) </code><code class="lua keyword">then</code></div>
<div class="line number41 index40 alt2"><code class="lua spaces">        </code><code class="lua comments">-- When in forward mode, we simply move forward at the desired speed</code></div>
<div class="line number42 index41 alt1"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(leftMotor,left_speed)</code></div>
<div class="line number43 index42 alt2"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(rightMotor,right_speed)</code></div>
<div class="line number44 index43 alt1"><code class="lua spaces">    </code><code class="lua keyword">else</code></div>
<div class="line number45 index44 alt2"><code class="lua spaces">        </code><code class="lua comments">-- When in backward mode, we simply backup in a curve at reduced speed</code></div>
<div class="line number46 index45 alt1"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(leftMotor,-left_speed/2)</code></div>
<div class="line number47 index46 alt2"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(rightMotor,-right_speed/8)</code></div>
<div class="line number48 index47 alt1"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number49 index48 alt2"><code class="lua keyword">end</code></div>
<div class="line number50 index49 alt1"> </div>
<div class="line number51 index50 alt2"><code class="lua keyword">function</code> <code class="lua plain">sysCall_cleanup() </code></div>
<div class="line number52 index51 alt1"><code class="lua spaces">    </code><code class="lua plain">simUI.destroy(ui)</code></div>
<div class="line number53 index52 alt2"><code class="lua keyword">end</code></div>
<div class="line number53 index52 alt2"><code class="lua keyword"></code></div>
<div class="line number53 index52 alt2"><code class="lua keyword">]</code></div>
</div>
<br />V-rep Introduction << <a href='V-rep Introduction.html'>Previous</a> <a href='BubbleRob1.html'>Next</a> >> BubbleRob1</div></section></div></body></html>