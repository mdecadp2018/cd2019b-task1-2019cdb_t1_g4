<!doctype html>
<html><head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>CMSimfly</title> <link rel="stylesheet" type="text/css" href="./../static/cmsimply.css">
<script src="tipuesearch_content.js"></script>
<script src="./../static/jquery.js"></script>
<link rel="stylesheet" href="./../static/tipuesearch/css/tipuesearch.css">
<script src="./../static/tipuesearch/tipuesearch_set.js"></script>
<script src="./../static/tipuesearch/tipuesearch.min.js"></script>

<script type="text/javascript" src="./../static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCSharp.js"></script>
<link type="text/css" rel="stylesheet" href="./../static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>

<!-- for LaTeX equations 暫時不用
<script src="https://scrum-3.github.io/web/math/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'left', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>
-->
<!-- 暫時不用
<script src="./../static/fengari-web.js"></script>
<script type="text/javascript" src="./../static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->

<script type="text/javascript">
/*shorthand of $(document).ready(function(){};); */
$(function(){
    $("ul.topmenu> li:has(ul) > a").append('<div class="arrow-right"></div>');
    $("ul.topmenu > li ul li:has(ul) > a").append('<div class="arrow-right"></div>');
});
function doSearch() {
     $('#tipue_search_input').tipuesearch({
        newWindow: true, minimumLength: 2
     });
}
$(document).ready(doSearch);
</script>

</head><header><h1>BG4 2019 Spring Product Collaboration Design</h1> <confmenu>
<ul>
<li><a href="index.html">Home</a></li>
<li><a href="sitemap.html">Site Map</a></li>
<li><a href="./../reveal/index.html">reveal</a></li>
<li><a href="./../blog/index.html">blog</a></li>

</ul>
</confmenu></header>
<div class='container'><nav><ul id='css3menu1' class='topmenu'><div class="tipue_search_group"><input style="width: 6vw;" type="text" name="q" id="tipue_search_input" pattern=".{2,}" title="Press enter key to search" required></div><li><a href='Introduction.html'>Introduction</a><li><a href='Group Member.html'>Group Member</a><li><a href='Internship.html'>Internship</a><ul><li><a href='Internship 1.html'>Internship 1</a><ul><li><a href='隨身系統.html'>隨身系統</a><li><a href='第一週分組程式.html'>第一週分組程式</a></li></ul><li><a href='Internship 2.html'>Internship 2</a><ul><li><a href='V-rep Introduction.html'>V-rep Introduction</a><li><a href='BubbleRob.html'>BubbleRob</a><li><a href='BubbleRob1.html'>BubbleRob1</a></li></ul><li><a href='Internship 3.html'>Internship 3</a><li><a href='Internship 4.html'>Internship 4</a><li><a href='Internship 5.html'>Internship 5</a><li><a href='Internship 6.html'>Internship 6</a></li></ul><li><a href='Weekly Progress.html'>Weekly Progress</a><ul><li><a href='Week4.html'>Week4</a><ul><li><a href='40623210-w4.html'>40623210-w4</a><li><a href='40623224-w4.html'>40623224-w4</a><li><a href='40623225-w4.html'>40623225-w4</a><li><a href='40623227-w4.html'>40623227-w4</a><li><a href='40623234-w4.html'>40623234-w4</a><li><a href='40623238-w4.html'>40623238-w4</a><li><a href='40423158-w4.html'>40423158-w4</a><li><a href='40423232-w4.html'>40423232-w4</a><li><a href='40423237-w4.html'>40423237-w4</a></li></ul><li><a href='Week5.html'>Week5</a><ul><li><a href='40623210-w5.html'>40623210-w5</a><li><a href='40623224-w5.html'>40623224-w5</a><li><a href='40623225-w5.html'>40623225-w5</a><li><a href='40623227-w5.html'>40623227-w5</a><li><a href='40623234-w5.html'>40623234-w5</a><li><a href='40623238-w5.html'>40623238-w5</a><li><a href='40423158-w5.html'>40423158-w5</a><li><a href='40423237-w5.html'>40423237-w5</a></li></ul><li><a href='Week6.html'>Week6</a><li><a href='Week7.html'>Week7</a><li><a href='Week8.html'>Week8</a><li><a href='Week9.html'>Week9</a></li></ul><li><a href='Operation Demo.html'>Operation Demo</a><ul><li><a href='如何建立可攜程式系統.html'>如何建立可攜程式系統</a><li><a href='Start.bat製作.html'>Start.bat製作</a><li><a href='Stop.bat製作.html'>Stop.bat製作</a><li><a href='Kungit 製作.html'>Kungit 製作</a></li></ul><li><a href='Git http & ssh.html'>Git http & ssh</a><li><a href='Directory Structure.html'>Directory Structure</a><li><a href='Page Editing.html'>Page Editing</a><ul><li><a href='插入程式碼.html'>插入程式碼</a><ul><li><a href='Java 程式碼.html'>Java 程式碼</a><li><a href='Python 程式碼.html'>Python 程式碼</a><li><a href='C或C++程式碼.html'>C或C++程式碼</a><li><a href='Lua 程式碼.html'>Lua 程式碼</a><li><a href='Javascript 程式碼.html'>Javascript 程式碼</a><li><a href='Html 原始碼.html'>Html 原始碼</a></li></li></ul></ul><li><a href='Internet Reveal.html'>Internet Reveal</a><li><a href='Blog Editor.html'>Blog Editor</a><li><a href='Issue & Solution.html'>Issue & Solution</a><li><a href='Experience.html'>Experience</a><ul><li><a href='40623210.html'>40623210</a><li><a href='40623224.html'>40623224</a><li><a href='40623225.html'>40623225</a><li><a href='40623226.html'>40623226</a><li><a href='40623227.html'>40623227</a><li><a href='40623234.html'>40623234</a><li><a href='40623238.html'>40623238</a><li><a href='40623239.html'>40623239</a><li><a href='40423158.html'>40423158</a><li><a href='40423232.html'>40423232</a><li><a href='40423237.html'>40423237</a></li></ul></nav><section><div id="tipue_search_content">BubbleRob << <a href='BubbleRob.html'>Previous</a> <a href='Internship 3.html'>Next</a> >> Internship 3<br /><h1>BubbleRob1</h1>
<p>Sphere diameter: 0.2 m</p>
<p>Wheel cylinder: 0.08 m dia x 0.02 m, target velocity 50 deg/s, max torque 2.5 N.m</p>
<p>Slider diameter: 0.05 m</p>
<p>Proximity sensor: cone type, Offset 0.005 m, Angle 30 and Range 0.15 m</p>
<p>Obstacle cylinder: 0.1 m dia x 0.2 m</p>
<p><span>This tutorial will try to introduce quite many V-REP functionalities while designing the simple mobile robot </span><em>BubbleRob</em><span>. The V-REP scene file related to this tutorial is located in V-REP's installation folder's<span> </span></span><em>tutorials/BubbleRob</em><span><span> </span>folder. Following figure illustrates the simulation scene that we will design:</span></p>
<p><span><img alt="" height="398" src="./../images/BubbleRob1-1.png" width="700"/></span></p>
<p>Since this tutorial will fly over many different aspects, make sure to also have a look at the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/tutorials.htm">other tutorials</a>, mainly the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/buildingAModelTutorial.htm">tutorial about building a simulation model</a>. First of all, freshly start V-REP. The simulator displays a default<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/scenes.htm">scene</a>. We will start with the body of<span> </span><em>BubbleRob</em>.</p>
<p>We add a primitive sphere of diameter 0.2 to the scene with [Menu bar --&gt; Add --&gt; Primitive shape --&gt; Sphere]. We adjust the<span> </span><strong>X-size</strong><span> </span>item to 0.2, then click<span> </span><strong>OK</strong>. The created sphere will appear in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/layerSelectionDialog.htm">visibility layer</a><span> </span>1 by default, and be<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/designingDynamicSimulations.htm#staticAndRespondable">dynamic and respondable</a><span> </span>(since we kept the item<span> </span><strong>Create dynamic and respondable shape</strong><span> </span>enabled). This means that<span> </span><em>BubbleRob's</em><span> </span>body will be falling and able to react to collisions with other respondable shapes (i.e. simulated by the physics engine). We can see this is the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/shapeDynamicsProperties.htm">shape dynamics properties</a>: items<span> </span><strong>Body is respondable</strong><span> </span>and<span> </span><strong>Body is dynamic</strong><span> </span>are enabled. We start the simulation (via the toolbar button, or by pressing &lt;control-space&gt; in the scene window), and copy-and-paste the created sphere (with [Menu bar --&gt; Edit --&gt; Copy selected objects] then [Menu bar --&gt; Edit -&gt; Paste buffer], or with &lt;control-c&gt; then &lt;control-v&gt;): the two spheres will react to collision and roll away. We stop the simulation: the duplicated sphere will automatically be removed. This default behaviour can be modified in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/simulationPropertiesDialog.htm">simulation dialog</a>.</p>
<p>We also want the<span> </span><em>BubbleRob's</em><span> </span>body to by usable by the other calculation modules (e.g. the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/distanceCalculation.htm">minimum distance calculation module</a>). For that reason, we enable<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/collidableObjects.htm">Collidable</a></strong>,<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/measurableObjects.htm">Measurable</a></strong>,<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/renderableObjects.htm">Renderable</a></strong><span> </span>and<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/detectableObjects.htm">Detectable</a></strong><span> </span>in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/commonPropertiesDialog.htm">object common properties</a><span> </span>for that shape, if not already enabled. If we wanted, we could now also change the visual appearance of our sphere in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/shapeProperties.htm">shape properties</a>.</p>
<p>Now we open the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/positionDialog.htm">position dialog</a><span> </span>on the<span> </span><strong>translation</strong><span> </span>tab, select the sphere representing<span> </span><em>BubbleRob's</em><span> </span>body, and enter 0.02 for<span> </span><strong>Along Z</strong>. We make sure that the<strong>Relative to</strong>-item is set to<span> </span><strong>World</strong>. Then we click<span> </span><strong>Translate selection</strong>. This translates all selected objects by 2 cm along the absolute Z-axis, and effectively lifted our sphere a little bit. In the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/userInterface.htm#SceneHierarchy">scene hierarchy</a>, we double-click the sphere's name, so that we can edit its name. We enter<span> </span><em>bubbleRob</em><span> </span>and press enter.</p>
<p>Next we will add a<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/proximitySensors.htm">proximity sensor</a><span> </span>so that<span> </span><em>BubbleRob</em><span> </span>knows when it is approaching obstacles: we select [Menu bar --&gt; Add --&gt; Proximity sensor --&gt; Cone type]. In the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/orientationDialog.htm">orientation dialog</a><span> </span>on the<span> </span><strong>orientation</strong><span> </span>tab, we enter 90 for<span> </span><strong>Around Y</strong><span> </span>and for<span> </span><strong>Around Z</strong>, then click<span> </span><strong>Rotate selection</strong>. In the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/positionDialog.htm">position dialog</a>, on the<span> </span><strong>position</strong>tab, we enter 0.1 for<span> </span><strong>X-coord.</strong><span> </span>and 0.12 for<span> </span><strong>Z-coord.</strong><span> </span>The proximity sensor is now correctly positioned relative to<span> </span><em>BubbleRob's</em><span> </span>body. We double-click the proximity sensor's icon in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/userInterface.htm#SceneHierarchy">scene hierarchy</a><span> </span>to open<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/proximitySensorPropertiesDialog.htm">its properties</a><span> </span>dialog. We click<span> </span><strong>Show volume parameter<span> </span></strong>to open the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/proximitySensorVolumeDialog.htm">proximity sensor volume dialog</a>. We adjust items<span> </span><strong>Offset</strong><span> </span>to 0.005,<span> </span><strong>Angle</strong><span> </span>to 30 and<span> </span><strong>Range</strong><span> </span>to 0.15. Then, in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/proximitySensorPropertiesDialog.htm">proximity sensor properties</a>, we click<span> </span><strong>Show detection parameters</strong>. This opens the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/proximitySensorDetectionParameterDialog.htm">proximity sensor detection parameter dialog</a>. We uncheck item<span> </span><strong>Don't allow detections if distance smaller than</strong><span> </span>then close that dialog again. In the scene hierarchy, we double-click the proximity sensor's name, so that we can edit its name. We enter<span> </span><em>bubbleRob_sensingNose</em><span> </span>and press enter.</p>
<p><img alt="" height="640" src="./../images/BubbleRob1-2.png" width="700"/></p>
<p><span>We select</span><span> </span><em>bubbleRob_sensingNose</em><span>, then control-select</span><span> </span><em>bubbleRob</em><span>, then click [Menu bar --&gt; Edit --&gt; Make last selected object parent]. This attaches the sensor to the body of the robot. We could also have dragged</span><span> </span><em>bubbleRob_sensingNose</em><span> </span><span>onto</span><span> </span><em>bubbleRob</em><span> </span><span>in the scene hierarchy. This is what we now have:</span></p>
<p><span><img alt="" height="398" src="./../images/BubbleRob1-3.png" width="700"/></span></p>
<p>Next we will take care of<span> </span><em>BubbleRob's</em><span> </span>wheels. We create a new scene with [Menu bar --&gt; File --&gt; New scene]. It is often very convenient to work across several scenes, in order to visualize and work only on specific elements. We add a pure primitive cylinder with dimensions (0.08,0.08,0.02). As for the body of<span> </span><em>BubbleRob</em>, we enable<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/collidableObjects.htm">Collidable</a></strong>,<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/measurableObjects.htm">Measurable</a></strong>,<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/renderableObjects.htm">Renderable</a></strong><span> </span>and<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/detectableObjects.htm">Detectable</a></strong><span> </span>in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/commonPropertiesDialog.htm">object common properties</a><span> </span>for that cylinder, if not already enabled. Then we set the cylinder's absolute position to (0.05,0.1,0.04) and its absolute orientation to (-90,0,0). We change the name to<span> </span><em>bubbleRob_leftWheel</em>. We copy and paste the wheel, and set the absolute Y coordinate of the copy to -0.1. We rename the copy to<span> </span><em>bubbleRob_rightWheel</em>. We select the two wheels, copy them, then switch back to scene 1, then paste the wheels.</p>
<p>We now need to add<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/joints.htm">joints</a><span> </span>(or motors) for the wheels. We click [Menu bar --&gt; Add --&gt; Joint --&gt; Revolute] to add a revolute joint to the scene. Most of the time, when adding a new object to the scene, the object will appear at the origin of the world. We Keep the joint selected, then control-select<span> </span><em>bubbleRob_leftWheel</em>. In the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/positionDialog.htm">position dialog</a>, on the<span> </span><strong>position</strong><span> </span>tab, we click the<span> </span><strong>Apply to selection</strong><span> </span>button: this positioned the joint at the center of the left wheel. Then, in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/orientationDialog.htm">orientation dialog</a>, on the<span> </span><strong>orientation</strong><span> </span>tab, we do the same: this oriented the joint in the same way as the left wheel. We rename the joint to<span> </span><em>bubbleRob_leftMotor</em>. We now double-click the joint's icon in the scene hierarchy to open the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/jointProperties.htm">joint properties</a><span> </span>dialog. Then we click<span> </span><strong>Show dynamic parameters</strong><span> </span>to open the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/jointDynamicsProperties.htm">joint dynamics properties</a>dialog. We<span> </span><strong>enable the motor</strong>, and check item<span> </span><strong>Lock motor when target velocity is zero</strong>. We now repeat the same procedure for the right motor and rename it to<span> </span><em>bubbleRob_rightMotor</em>. Now we attach the left wheel to the left motor, the right wheel to the right motor, then attach the two motors to<span> </span><em>bubbleRob</em>. This is what we have:</p>
<p><img alt="" height="398" src="./../images/BubbleRob1-4.png" width="700"/></p>
<p><span>We run the simulation and notice that the robot is falling backwards. We are still missing a third contact point to the floor. We now add a small slider (or caster). In a new scene we and add a pure primitive sphere with diameter 0.05 and make the sphere </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/collidableObjects.htm">Collidable</a></strong><span>, </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/measurableObjects.htm">Measurable</a></strong><span>, </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/renderableObjects.htm">Renderable</a></strong><span> and </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/detectableObjects.htm">Detectable</a></strong><span> (if not already enabled), then rename it to </span><em>bubbleRob_slider</em><span>. We set the </span><strong>Material</strong><span> to </span><em>noFrictionMaterial<span> </span></em><span>in the </span><a href="http://www.coppeliarobotics.com/helpFiles/en/shapeDynamicsProperties.htm">shape dynamics properties</a><span>. To rigidly link the slider with the rest of the robot, we add a</span><a href="http://www.coppeliarobotics.com/helpFiles/en/forceSensors.htm"><span> </span>force sensor object</a><span> with [Menu bar --&gt; Add --&gt; Force sensor]. We rename it to </span><em>bubbleRob_connection</em><span> and shift it up by 0.05. We attach the slider to the force sensor, then copy both objects, switch back to scene 1 and paste them. We then shift the force sensor by -0.07 along the absolute X-axis, then attach it to the robot body. If we run the simulation now, we can notice that the slider is slightly moving in relation to the robot body: this is because both objects (i.e. </span><em>bubbleRob_slider</em><span> and </span><em>bubbleRob</em><span>) are colliding with each other. To avoid strange effects during dynamics simulation, we have to inform V-REP that both objects do not mutually collide, and we do this in following way: in the </span><a href="http://www.coppeliarobotics.com/helpFiles/en/shapeDynamicsProperties.htm">shape dynamics properties</a><span>, for </span><em>bubbleRob_slider</em><span> we set the </span><strong>local respondable mask</strong><span> to 00001111, and for </span><em>bubbleRob</em><span>, we set the</span><strong><span> </span>local respondable mask</strong><span> to 11110000. If we run the simulation again, we can notice that both objects do not interfere anymore. This is what we now have:</span></p>
<p>We run the simulation again and notice that<span> </span><em>BubbleRob</em><span> </span>slightly moves, even with locked motor. We also try to run the simulation with different physics engines: the result will be different. Stability of dynamic simulations is tightly linked to masses and inertias of the involved non-static shapes. For an explanation of this effect, make sure to carefully read<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/designingDynamicSimulations.htm#masses">this</a><span> </span>and<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/designingDynamicSimulations.htm#inertias">that</a><span> </span>sections. We now try to correct for that undesired effect. We select the two wheels and the slider, and in the shape dynamics dialog we click three times<span> </span><strong>M=M*2 (for selection)</strong>. The effect is that all selected shapes will have their masses multiplied by 8. We do the same with the inertias of the 3 selected shapes, then run the simulation again: stability has improved. In the joint dynamics dialog, we set the<span> </span><strong>Target velocity</strong><span> </span>to 50 for both motors. We run the simulation:<span> </span><em>BubbleRob</em><span> </span>now moves forward and eventually falls off the floor. We reset the<span> </span><strong>Target velocity</strong><span> </span>item to zero for both motors.</p>
<p>The object<span> </span><em>bubbleRob</em><span> </span>is at the base of all<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/objects.htm">objects</a><span> </span>that will later form the<span> </span><em>BubbleRob</em><span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/models.htm">model</a>. We will define the model a little bit later. In the mean time, we want to define a collection of objects that represent<span> </span><em>BubbleRob</em>. For that we define a<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/collections.htm">collection object</a>. We click [Menu bar --&gt; Tools --&gt; Collections] to open the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/collectionsDialog.htm">collection dialog</a>. Alternatively we can also open the dialog by clicking the appropriate toolbar button:</p>
<p>In the collection dialog, we click<span> </span><strong>Add new collection</strong>. A new collection object appears in the list just below. For now the newly added collection is still empty (not defined). While the new collection item is selected in the list, select<span> </span><em>bubbleRob</em><span> </span>in the scene hierarchy, and then click<span> </span><strong>Add</strong><span> </span>in the collection dialog. Our collection is now defined as containing all objects of the hierarchy tree starting at the<span> </span><em>bubbleRob</em><span> </span>object (the collection's composition is displayed in the<span> </span><strong>Composing elements and attributes</strong><span> </span>section). To edit the collection name, we double-click it, and rename it to<span> </span><em>bubbleRob_collection</em>. We close the collection dialog.</p>
<p>At this stage we want to be able to track the minimum distance between BubbleRob and any other object. For that, we open the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/distanceCalculation.htm">distance dialog</a><span> </span>with [Menu bar --&gt; Tools --&gt; Calculation module properties]. Alternatively we can also open the calculation module properties dialog with the appropriate toolbar button:</p>
<p>In the distance dialog, we click<span> </span><strong>Add new distance object</strong><span> </span>and select a distance pair:<span> </span><em>[collection] bubbleRob_collection - all other measurable objects in the scene</em>. This just added a distance object that will measure the smallest distance between collection<span> </span><em>bubbleRob_collection</em><span> </span>(i.e. any<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/measurableObjects.htm">measurable object</a><span> </span>in that collection) and any other measurable object in the scene. We rename the distance object to<span> </span><em>bubbleRob_distance</em><span> </span>with a double-click in its name. We close the distance dialog. When we now run the simulation, we won't see any difference, since the distance object will try to measure (and display) the smallest distance segment between<span> </span><em>BubbleRob</em><span> </span>and any other measurable object in the scene. The problem is that at this stage there is no other measurable object in the scene (the shape defining the floor has its measurable property turned off by default). At a later stage in this tutorial, we will add obstacles to our scene.</p>
<p>Next we are going to add a<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/graphs.htm">graph object</a><span> </span>to<span> </span><em>BubbleRob</em><span> </span>in order to display above smallest distance, but also<span> </span><em>BubbleRob's</em><span> </span>trajectory over time. We click [Menu bar --&gt; Add --&gt; Graph] and rename it to<span> </span><em>bubbleRob_graph</em>. We attach the graph to<span> </span><em>bubbleRob</em>, and set the graph's absolute coordinates to (0,0,0.005). Now we open the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/graphPropertiesDialog.htm">graph properties</a><span> </span>dialog by double-clicking its icon in the scene hierarchy. We uncheck<span> </span><strong>Display XYZ-planes</strong>, then click<span> </span><strong>Add new data stream to record</strong><span> </span>and select<span> </span><strong>Object: absolute x-position</strong><span> </span>for the<span> </span><strong>Data stream type</strong>, and<span> </span><em>bubbleRob_graph</em><span> </span>for the<span> </span><strong>Object / item to record</strong>. An item has appeared in the<span> </span><strong>Data stream recording list</strong>. That item is a data stream of<span> </span><em>bubbleRob_graph's</em><span> </span>absolute x-coordinate (i.e. the<span> </span><em>bubbleRobGraph's</em><span> </span>object absolute x position will be recorded). Now we also want to record the y and z positions: we add those data streams in a similar way as above. We now have 3 data streams that represent BubbleRob's x-, y- and z-trajectories. We are going to add one more data stream so that we are able to track the minimum distance between our robot and its environment: we click<span> </span><strong>Add new data stream to record</strong><span> </span>and select<span> </span><strong>Distance: segment length</strong><span> </span>for the<span> </span><strong>Data stream type</strong>, and<span> </span><em>bubbleRob_distance</em><span> </span>for the<span> </span><strong>Object / item to record</strong>. In the<span> </span><strong>Data stream recording list</strong>, we now rename Data to bubbleRob_x_pos, Data0 to bubbleRob_y_pos, Data1 to bubbleRob_z_pos, and Data2 to bubbleRob_obstacle_dist.</p>
<p>We select<span> </span><em>bubbleRob_x_pos</em><span> </span>in the<span> </span><strong>Data Stream recording list</strong><span> </span>and in the<span> </span><strong>Time graph properties</strong><span> </span>section, uncheck<span> </span><strong>Visible</strong>. We do the same for<span> </span><em>bubbleRob_y_pos</em><span> </span>and<span> </span><em>bubbleRob_z_pos</em>. By doing so, only the<span> </span><em>bubbleRob_obstacle_dist</em><span> </span>data stream will be visible in a time graph. Following is what we should have:</p>
<p>Next we will set-up a 3D curve that displays<span> </span><em>BubbleRob's</em><span> </span>trajectory: we click<span> </span><strong>Edit 3D curves</strong><span> </span>to open the<a href="http://www.coppeliarobotics.com/helpFiles/en/graphCurvePropertiesDialog.htm"><span> </span>XY graph and 3D curve dialog</a>, then click<span> </span><strong>Add new curve</strong>. In the dialog that pops open, we select<span> </span><em>bubbleRob_x_pos</em><span> </span>for the<span> </span><strong>X-value</strong><span> </span>item,<span> </span><em>bubbleRob_y_pos</em><span> </span>for the<span> </span><strong>Y-value</strong><span> </span>item and<span> </span><em>bubbleRob_z_pos</em><span> </span>for the<span> </span><strong>Z-value</strong><span> </span>item. We rename the newly added curve from<span> </span><em>Curve</em><span> </span>to bubbleRob_path. Finally, we check the<span> </span><strong>Relative to world</strong><span> </span>item and set<span> </span><strong>Curve width</strong><span> </span>to 4:</p>
<p>We close all dialogs related to graphs. Now we set one motor<span> </span><strong>target velocity</strong><span> </span>to 50, run the simulation, and will see<span> </span><em>BubbleRob's</em><span> </span>trajectory displayed in the scene. We then stop the simulation and reset the motor target velocity to zero.</p>
<p>We add a pure primitive cylinder with following dimensions: (0.1, 0.1, 0.2). We want this cylinder to be static (i.e. not influenced by gravity or collisions) but still exerting some collision responses on non-static respondable shapes. For this, we disable<span> </span><strong>Body is dynamic</strong><span> </span>in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/shapeDynamicsProperties.htm">shape dynamics properties</a>. We also want our cylinder to be<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/collidableObjects.htm">Collidable</a></strong>,<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/measurableObjects.htm">Measurable</a></strong>,<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/renderableObjects.htm">Renderable</a></strong><span> </span>and<span> </span><strong><a href="http://www.coppeliarobotics.com/helpFiles/en/detectableObjects.htm">Detectable</a></strong>. We do this in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/commonPropertiesDialog.htm">object common properties</a>. Now, while the cylinder is still selected, we click the object translation toolbar button:</p>
<p>Now we can drag any point in the scene: the cylinder will follow the movement while always being constrained to keep the same Z-coordinate. We copy and paste the cylinder a few times, and move them to positions around<span> </span><em>BubbleRob</em><span> </span>(it is most convenient to perform that while looking at the scene from the top). During object shifting, holding down the shift key allows to perform smaller shift steps. Holding down the ctrl key allows to move in an orthogonal direction to the<span> </span><em>regular</em>direction(s). When done, select the camera pan toolbar button again:</p>
<p>We set a<span> </span><strong>target velocity</strong><span> </span>of 50 for the left motor and run the simulation: the graph view now displays the distance to the closest obstacle and the distance segment is visible in the scene too. We stop the simulation and reset the target velocity to zero.</p>
<p>We now need to finish<span> </span><strong>BubbleRob</strong><span> </span>as a<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/models.htm">model</a><span> </span>definition. We select the model base (i.e. object<span> </span><em>bubbleRob</em>) then check items<span> </span><strong>Object is model base</strong><span> </span>and<span> </span><strong>Object/model can transfer or accept DNA</strong><span> </span>in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/commonPropertiesDialog.htm">object common properties</a>: there is now a stippled bounding box that encompasses all objects in the model hierarchy. We select the two joints, the proximity sensor and the graph, then enable item<span> </span><strong>Don't show as inside model selection</strong><span> </span>and click<span> </span><strong>Apply to selection</strong>, in the same dialog: the model bounding box now ignores the two joints and the proximity sensor. Still in the same dialog, we disable<span> </span><strong>camera visibility layer</strong><span> </span>2, and enable<span> </span><strong>camera visibility layer</strong><span> </span>10 for the two joints and the force sensor: this effectively hides the two joints and the force sensor, since layers 9-16 are disabled by default. At any time we can<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/layerSelectionDialog.htm">modify the visibility layers for the whole scene</a>. To finish the model definition, we select the vision sensor, the two wheels, the slider, and the graph, then enable item<span> </span><strong>Select base of model instead</strong>: if we now try to select an object in our model in the scene, the whole model will be selected instead, which is a convenient way to handle and manipulate the whole model as a single object. Additionally, this protects the model against inadvertant modification. Individual objects in the model can still be selected in the scene by click-selecting them with control-shift, or normally selecting them in the scene hierarchy. We finally collapse the model tree in the scene hierarchy. This is what we have:</p>
<p>Next we will add a<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/visionSensors.htm">vision sensor</a>, at the same position and orientation as<span> </span><em>BubbleRob's</em><span> </span>proximity sensor. We open the model hierarchy again, then click [Menu bar --&gt; Add --&gt; Vision sensor --&gt; Perspective type], then attach the vision sensor to the proximity sensor, and set the local position and orientation of the vision sensor to (0,0,0). We also make sure the vision sensor is not not visible, not part of the model bounding box, and that if clicked, the model will be selected instead. In order to customize the vision sensor, we open<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/visionSensorPropertiesDialog.htm">its properties</a><span> </span>dialog. We set the<span> </span><strong>Far clipping plane</strong><span> </span>item to 1, and the<span> </span><strong>Resolution x</strong><span> </span>and<span> </span><strong>Resolution y</strong><span> </span>items to 256 and 256. We then open the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/visionSensorFilterDialog.htm">vision sensor filter dialog</a><span> </span>by clicking<span> </span><strong>Show filter dialog</strong>. We select the filter component<span> </span><strong>Edge detection on work image</strong><span> </span>and click<span> </span><strong>Add filter</strong>. We position the newly added filter in second position (one position up, using the<span> </span><strong>up</strong><span> </span>button). We double-click the newly added filter component and adjust its<span> </span><strong>Threshold</strong><span> </span>item to 0.2, then click<span> </span><strong>OK</strong>. We add a floating view to the scene, and over the newly added floating view, right-click [Popup menu --&gt; View --&gt; Associate view with selected vision sensor] (we make sure the vision sensor is selected during that process). To be able to see the vision sensor's image, we start the simulation, then stop it again.</p>
<p>The last thing that we need for our scene is a small<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/childScripts.htm">child script</a><span> </span>that will control<span> </span><em>BubbleRob's</em><span> </span>behavior. We select<span> </span><em>bubbleRob</em><span> </span>and click [Menu bar --&gt; Add --&gt; Associated child script --&gt; Non threaded]. This just added a<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/childScripts.htm#nonThreaded">non-threaded child script</a><span> </span>to the scene, and associated it with<span> </span><em>bubbleRob</em>. We can also add, remove or modify scripts via the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/scriptProperties.htm">script dialog</a><span> </span>which can be opened with [Menu bar --&gt; Tools --&gt; Scripts] or through the appropriate toolbar button:</p>
<p><span>We double-click the little script icon that appeared next to </span><em>bubbleRob's</em><span><span> </span>name in the scene hierarchy: this opens the child script that we just added. We copy and paste following code into the<span> </span></span><a href="http://www.coppeliarobotics.com/helpFiles/en/scriptEditor.htm">script editor</a><span>, then close it:</span></p>
<p><span>[</span></p>
<div class="line number1 index0 alt2"><code class="lua keyword">function</code> <code class="lua plain">speedChange_callback(ui,id,newVal)</code></div>
<div class="line number2 index1 alt1"><code class="lua spaces">    </code><code class="lua plain">speed=minMaxSpeed[1]+(minMaxSpeed[2]-minMaxSpeed[1])*newVal/100</code></div>
<div class="line number3 index2 alt2"><code class="lua keyword">end</code></div>
<div class="line number4 index3 alt1"> </div>
<div class="line number5 index4 alt2"><code class="lua keyword">function</code> <code class="lua plain">sysCall_init()</code></div>
<div class="line number6 index5 alt1"><code class="lua spaces">    </code><code class="lua comments">-- This is executed exactly once, the first time this script is executed</code></div>
<div class="line number7 index6 alt2"><code class="lua spaces">    </code><code class="lua plain">bubbleRobBase=sim.getObjectAssociatedWithScript(sim.handle_self) </code><code class="lua comments">-- this is bubbleRob's handle</code></div>
<div class="line number8 index7 alt1"><code class="lua spaces">    </code><code class="lua plain">leftMotor=sim.getObjectHandle(</code><code class="lua string">"bubbleRob_leftMotor"</code><code class="lua plain">) </code><code class="lua comments">-- Handle of the left motor</code></div>
<div class="line number9 index8 alt2"><code class="lua spaces">    </code><code class="lua plain">rightMotor=sim.getObjectHandle(</code><code class="lua string">"bubbleRob_rightMotor"</code><code class="lua plain">) </code><code class="lua comments">-- Handle of the right motor</code></div>
<div class="line number10 index9 alt1"><code class="lua spaces">    </code><code class="lua plain">noseSensor=sim.getObjectHandle(</code><code class="lua string">"bubbleRob_sensingNose"</code><code class="lua plain">) </code><code class="lua comments">-- Handle of the proximity sensor</code></div>
<div class="line number11 index10 alt2"><code class="lua spaces">    </code><code class="lua plain">minMaxSpeed={50*</code><code class="lua functions">math.pi</code><code class="lua plain">/180,300*</code><code class="lua functions">math.pi</code><code class="lua plain">/180} </code><code class="lua comments">-- Min and max speeds for each motor</code></div>
<div class="line number12 index11 alt1"><code class="lua spaces">    </code><code class="lua plain">backUntilTime=-1 </code><code class="lua comments">-- Tells whether bubbleRob is in forward or backward mode</code></div>
<div class="line number13 index12 alt2"><code class="lua spaces">    </code><code class="lua comments">-- Create the custom UI:</code></div>
<div class="line number14 index13 alt1"><code class="lua spaces">        </code><code class="lua plain">xml = </code><code class="lua string">'&lt;ui title="'</code><code class="lua plain">..sim.getObjectName(bubbleRobBase)..</code><code class="lua string">' speed" closeable="false" resizeable="false" activate="false"&gt;'</code><code class="lua plain">..[[</code></div>
<div class="line number15 index14 alt2"><code class="lua spaces">        </code><code class="lua plain">&lt;hslider minimum=</code><code class="lua string">"0"</code> <code class="lua plain">maximum=</code><code class="lua string">"100"</code> <code class="lua plain">onchange=</code><code class="lua string">"speedChange_callback"</code> <code class="lua plain">id=</code><code class="lua string">"1"</code><code class="lua plain">/&gt;</code></div>
<div class="line number16 index15 alt1"><code class="lua spaces">        </code><code class="lua plain">&lt;label text=</code><code class="lua string">""</code> <code class="lua plain">style=</code><code class="lua string">"* {margin-left: 300px;}"</code><code class="lua plain">/&gt;</code></div>
<div class="line number17 index16 alt2"><code class="lua spaces">        </code><code class="lua plain">&lt;/ui&gt;</code></div>
<div class="line number18 index17 alt1"><code class="lua spaces">        </code><code class="lua plain">]]</code></div>
<div class="line number19 index18 alt2"><code class="lua spaces">    </code><code class="lua plain">ui=simUI.create(xml)</code></div>
<div class="line number20 index19 alt1"><code class="lua spaces">    </code><code class="lua plain">speed=(minMaxSpeed[1]+minMaxSpeed[2])*0.5</code></div>
<div class="line number21 index20 alt2"><code class="lua spaces">    </code><code class="lua plain">simUI.setSliderValue(ui,1,100*(speed-minMaxSpeed[1])/(minMaxSpeed[2]-minMaxSpeed[1]))</code></div>
<div class="line number22 index21 alt1"><code class="lua keyword">end</code></div>
<div class="line number23 index22 alt2"> </div>
<div class="line number24 index23 alt1"><code class="lua keyword">function</code> <code class="lua plain">sysCall_actuation()</code></div>
<div class="line number25 index24 alt2"><code class="lua spaces">    </code><code class="lua plain">result=sim.readProximitySensor(noseSensor) </code><code class="lua comments">-- Read the proximity sensor</code></div>
<div class="line number26 index25 alt1"><code class="lua spaces">    </code><code class="lua comments">-- If we detected something, we set the backward mode:</code></div>
<div class="line number27 index26 alt2"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua plain">(result&gt;0) </code><code class="lua keyword">then</code> <code class="lua plain">backUntilTime=sim.getSimulationTime()+4 </code><code class="lua keyword">end</code></div>
<div class="line number28 index27 alt1"> </div>
<div class="line number29 index28 alt2"><code class="lua spaces">    </code><code class="lua keyword">if</code> <code class="lua plain">(backUntilTime&lt;sim.getSimulationTime()) </code><code class="lua keyword">then</code></div>
<div class="line number30 index29 alt1"><code class="lua spaces">        </code><code class="lua comments">-- When in forward mode, we simply move forward at the desired speed</code></div>
<div class="line number31 index30 alt2"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(leftMotor,speed)</code></div>
<div class="line number32 index31 alt1"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(rightMotor,speed)</code></div>
<div class="line number33 index32 alt2"><code class="lua spaces">    </code><code class="lua keyword">else</code></div>
<div class="line number34 index33 alt1"><code class="lua spaces">        </code><code class="lua comments">-- When in backward mode, we simply backup in a curve at reduced speed</code></div>
<div class="line number35 index34 alt2"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(leftMotor,-speed/2)</code></div>
<div class="line number36 index35 alt1"><code class="lua spaces">        </code><code class="lua plain">sim.setJointTargetVelocity(rightMotor,-speed/8)</code></div>
<div class="line number37 index36 alt2"><code class="lua spaces">    </code><code class="lua keyword">end</code></div>
<div class="line number38 index37 alt1"><code class="lua keyword">end</code></div>
<div class="line number39 index38 alt2"> </div>
<div class="line number40 index39 alt1"><code class="lua keyword">function</code> <code class="lua plain">sysCall_cleanup()</code></div>
<div class="line number41 index40 alt2"><code class="lua spaces">    </code><code class="lua plain">simUI.destroy(ui)</code></div>
<div class="line number42 index41 alt1"><code class="lua keyword">end</code></div>
<div class="line number42 index41 alt1"><code class="lua keyword"></code></div>
<div class="line number42 index41 alt1"><code class="lua keyword">]</code></div>
<div class="line number42 index41 alt1"><code class="lua keyword"></code></div>
<div class="line number42 index41 alt1">
<p>We run the simulation.<span> </span><em>BubbleRob</em><span> </span>now moves forward while trying to avoid obstacles (in a very basic fashion). While the simulation is still running, change<span> </span><em>BubbleRob's</em><span> </span>velocity, and copy/paste it a few times. Also try to scale a few of them while the simulation is still running. Be aware that the minimum distance calculation functionality might be heavily slowing down the simulation, depending on the environment. You can turn that functionality on and off in the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/distanceCalculation.htm">distance dialog</a>, by checking / unchecking the<span> </span><strong>Enable all distance calculations</strong><span> </span>item.</p>
<p>Using a script to control a robot or model is only one way of doing. V-REP offers many different ways (also combined), have a look at the<span> </span><a href="http://www.coppeliarobotics.com/helpFiles/en/externalControllerTutorial.htm">external controller tutorial</a>.</p>
</div><br />BubbleRob << <a href='BubbleRob.html'>Previous</a> <a href='Internship 3.html'>Next</a> >> Internship 3</div></section></div></body></html>